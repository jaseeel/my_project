{% extends "admin_side/base.html" %}
{% block content %}
<style>
    .coupon-form-container {
        min-height: 100vh;
        padding: 2rem;
        background: #f8f9fa;
    }
    .coupon-form {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .coupon-form h2 {
        text-align: center;
        color: #007bff;
        margin-bottom: 1.5rem;
    }
    .form-group {
        margin-bottom: 1rem;
    }
    .form-control {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }
    .btn-submit {
        margin-top: 5px;
        width: 100%;
        padding: 0.75rem;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    .btn-submit:hover {
        background: #0056b3;
    }
    .error-message {
        color: red;
        font-size: 0.875em;
        margin-top: 0.25rem;
    }
</style>

<div class="coupon-form-container">
    <div class="coupon-form">
        <h2>EDIT COUPON</h2>
        <form id="couponForm" action="{% url 'edit_coupon' coupon.id %}" method="POST" onsubmit="return validateForm()">
            {% csrf_token %}
            <div class="form-group">
                <label for="code" class="form-label">Coupon Code:</label>
                <input type="text" class="form-control" id="code" name="code" value="{{ coupon.code }}">
                <div class="error-message" id="codeError"></div>
            </div>

            <div class="form-group">
                <label for="discount_type" class="form-label">Discount Type:</label>
                <select class="form-control" id="discount_type" name="discount_type">
                    <option value="percentage" {% if coupon.discount_type == 'percentage' %} selected {% endif %}>Percentage</option>
                    <option value="fixed" {% if coupon.discount_type == 'fixed' %} selected {% endif %}>Fixed Amount</option>
                </select>
            </div>

            <div class="form-group">
                <label for="discount_value" class="form-label">Discount Value:</label>
                <input type="number" class="form-control" id="discount_value" name="discount_value" value="{{ coupon.discount_value }}">
                <div class="error-message" id="discountValueError"></div>
            </div>

            <div class="form-group">
                <label for="min_order_value" class="form-label">Min Order Value:</label>
                <input type="number" class="form-control" id="min_order_value" name="min_order_value" value="{{ coupon.min_order_value }}">
                <div class="error-message" id="minOrderValueError"></div>
            </div>

            <div class="form-group">
                <label for="expiration_date" class="form-label">Expiration Date:</label>
                <input type="date" class="form-control" id="expiration_date" name="expiration_date" value="{{ coupon.expiration_date|date:'Y-m-d' }}">
                <div class="error-message" id="expirationDateError"></div>
            </div>

            <div class="form-group">
                <label for="max_uses" class="form-label">Max Uses:</label>
                <input type="number" class="form-control" id="max_uses" name="max_uses" value="{{ coupon.max_uses }}">
                <div class="error-message" id="maxUsesError"></div>
            </div>

            <button type="submit" class="btn-submit">Update</button>
        </form>
    </div>
</div>

<script>
    function validateForm() {
        var code = document.getElementById("code").value;
        var discountType = document.getElementById("discount_type").value;
        var discountValue = document.getElementById("discount_value").value;
        var minOrderValue = document.getElementById("min_order_value").value;
        var expirationDate = document.getElementById("expiration_date").value;
        var maxUses = document.getElementById("max_uses").value;

        var codeError = document.getElementById("codeError");
        var discountValueError = document.getElementById("discountValueError");
        var minOrderValueError = document.getElementById("minOrderValueError");
        var expirationDateError = document.getElementById("expirationDateError");
        var maxUsesError = document.getElementById("maxUsesError");

        var isValid = true;

        // Validate Coupon Code
        if (code === "") {
            codeError.innerText = "Coupon code is required";
            isValid = false;
        } else if (!/^[A-Z]+$/.test(code)) {
            codeError.innerText = "Coupon code should contain only capital letters without spaces";
            isValid = false;
        } else {
            codeError.innerText = "";
        }

        // Validate Discount Value
        if (discountValue === "") {
            discountValueError.innerText = "Discount value is required";
            isValid = false;
        } else if (discountType === "percentage" && (discountValue <= 0 || discountValue >= 99)) {
            discountValueError.innerText = "Percentage discount must be between 1 and 98";
            isValid = false;
        } else if (discountType === "fixed" && (discountValue <= 0 || discountValue >= 10000)) {
            discountValueError.innerText = "Fixed discount must be between 1 and 9999";
            isValid = false;
        } else {
            discountValueError.innerText = "";
        }

        // Validate Min Order Value
        if (minOrderValue === "") {
            minOrderValueError.innerText = "Min order value is required";
            isValid = false;
        } else if (minOrderValue <= 0) {
            minOrderValueError.innerText = "Min order value must be greater than 0";
            isValid = false;
        } else {
            minOrderValueError.innerText = "";
        }

        // Validate Expiration Date
        var currentDate = new Date();
        var minExpirationDate = new Date(currentDate.getTime() + 7 * 24 * 60 * 60 * 1000);
        var inputExpirationDate = new Date(expirationDate);

        if (expirationDate === "") {
            expirationDateError.innerText = "Expiration date is required";
            isValid = false;
        } else if (inputExpirationDate <= minExpirationDate) {
            expirationDateError.innerText = "Expiration date must be at least 7 days from today";
            isValid = false;
        } else {
            expirationDateError.innerText = "";
        }

        // Validate Max Uses
        if (maxUses === "") {
            maxUsesError.innerText = "Max uses is required";
            isValid = false;
        } else if (maxUses <= 0) {
            maxUsesError.innerText = "Max uses must be greater than 0";
            isValid = false;
        } else {
            maxUsesError.innerText = "";
        }

        return isValid;
    }
</script>
{% endblock %}