{% extends 'admin_side/base.html' %}


{% block content %}

<!-- Form style -->
<style>
    #image-box {
        width: 100%; /* Adjust width as needed */
        height: 400px; /* Adjust height as needed */
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden; /* Ensure the image doesn't overflow */
    }

    #image-box img {
        max-width: 100%; /* Ensure the image fits within the container */
        max-height: 100%; /* Ensure the image fits within the container */
    }



    form {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f9f9f9;
    }

    label {
        font-weight: bold;
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
        width: 100%;
        padding: 8px;
        margin: 5px 0;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    input[type="checkbox"] {
        margin-top: 10px;
    }

    button[type="submit"] {
        background-color: #4CAF50;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
    }

    button[type="submit"]:hover {
        background-color: #45a049;
    }
</style>
{% load static %}

{% comment %} <!-- --------------------------------------------- Form------------------------------------------------- --> {% endcomment %}

<form id="image-form" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
    {% csrf_token %}
    <!-- Product Fields -->
    <label for="title">Title:</label><br>
    <input type="text" id="title" name="title" value="{{product.title}}"><br><br>

    <label for="category">Category:</label><br>
    <select id="category" name="category" required>
        {% for category in categories %}
        <option value="{{ category.id }}">{{ category.name }}</option>
        {% endfor %}
    </select><br><br>

    <label for="description">Description:</label><br>
    <textarea id="description" name="description" rows="4" cols="50" oninput="removeWhitespace(this)" required></textarea><br><br>


    <label for="price">Price:</label><br>
    <input type="number" id="price" name="price" required><br><br>

    <label for="brand">Brand:</label><br>
    <select id="brand" name="brand" required>
        {% for choice in brands %}
        <option value="{{ choice.id }}">{{ choice.brand_name }}</option>
        {% endfor %}
    </select><br><br>

    <label for="status">Status:</label><br>
    <select id="status" name="status" required>
        {% for choice in status_choices %}
        <option value="{{ choice.0 }}">{{ choice.1 }}</option>
        {% endfor %}
    </select><br><br>

    <label for="stock_count">Stock Count:</label><br>
    <input type="number" id="stock_count" name="stock_count" required><br><br>

    <div id="image-box"></div>
    <label for="image">Image:</label><br>
    <input type="file" id="image" name="image" accept="image/*" required><br><br>
    <input type="hidden" id="cropped-image" name="cropped_image">
    <button id="btn-crop">Crop</button>
 
    

    <label for="sku">SKU:</label><br>
    <input type="text" id="sku" name="sku" required><br><br>

    <label for="weight">Weight:</label><br>
    <input type="number" id="weight" name="weight" step="0.01"><br><br>

    <label for="size">Size:</label><br>
    <input type="text" id="dimensions" name="size"><br><br>

    <label for="available">Available:</label>
    <input type="checkbox" id="available" name="available" checked><br><br>

    <label for="offer_price">Offer Price:</label>
    <input type="number" id="offer_price" value="{{ product.offer_price }}" name="offer_price"><br><br>

    <!-- Product Image Fields -->
    <div class="form-group">
        <label>Add multiple images</label>
        <div>
            <input class="form-control" type="file" placeholder="Select images" name="images" accept=".jpg, .jpeg, .gif, .png, .webp" multiple required>
            <small class="form-text text-muted">Max. file size: 10 MB. Allowed images: jpg, gif, png.</small>
        </div>
    </div>

    <!-- Other Product Image Fields -->
    <!-- Add fields for the product (if any), like the product selection dropdown -->

    <button style="margin-bottom:20px" type="submit">Submit</button>
    <dv>
        <button style="margin-bottom:20px"  type="submit">
    <a style="color: #f9f9f9;" href="{% url 'product_management' %}" >
         Back
    </a></button>
    <div>
</form>
<link  href="{% static 'assets/cropper/cropperjs/cropper.css' %}" rel="stylesheet">
<link  href="{% static 'assets/cropper/style.css' %}" rel="stylesheet">
<script src="{% static 'assets/cropper/cropperjs/cropper.js' %}"></script>



<!--      Validate form using js           -->
<script>
    function validateForm() {
    // Get the value of the price field
    var price = document.getElementById('price').value;
    
    // Remove leading and trailing whitespace
    price = price.trim();
    
    // Check if the price is a non-negative number
    if (price === "" || isNaN(price) || parseFloat(price) < 0) {
      alert("Price must be a non-negative number");
      return false;
    }
    
    if (description === ' ') {
      alert('Description cannot be empty.');
      return false;
    }
    
    // If all validations pass, return true
    return true;
    }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
        const imageForm = document.getElementById('image-form');
        const imageBox = document.getElementById('image-box');
        const input = document.getElementById('image');
        const croppedImageInput = document.getElementById('cropped-image'); // Select the hidden input for the cropped image
        
        input.addEventListener('change', () => {
            const imgData = input.files[0];
            const url = URL.createObjectURL(imgData);
            imageBox.innerHTML = `<img src="${url}" id="image">`;
            
            const image = document.getElementById('image');
            const cropper = new Cropper(image, {
                aspectRatio: 1.7777777777777777,
            });
            
            document.querySelector('#btn-crop').addEventListener('click', function() {
                cropper.getCroppedCanvas().toBlob(function(blob) {
                    // Convert the blob to a data URL and store it in the hidden input
                    const reader = new FileReader();
                    reader.onloadend = function() {
                    croppedImageInput.value = reader.result;
                    console.log("base64")
                    console.log(reader.result);
                    }
                    reader.readAsDataURL(blob);
                });
            });
        });
    </script>
    
    
   
    
{% endblock %}