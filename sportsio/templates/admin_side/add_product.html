{% extends 'admin_side/base.html' %}

{% block content %}
<style>
    .product-form-container {
        min-height: 100vh;
        padding: 2rem;
        background: #f8f9fa;
    }
    .product-form {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .product-form h2 {
        text-align: center;
        color: #007bff;
        margin-bottom: 1.5rem;
    }
    .form-group {
        margin-bottom: 1rem;
    }
    .form-control {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }
    .btn-submit {
        width: 100%;
        padding: 0.75rem;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    .btn-submit:hover {
        background: #0056b3;
    }
    .checkbox-group {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }
    .checkbox-group label {
        margin-left: 0.5rem;
    }
    .error-message {
        color: red;
        font-size: 0.875em;
        margin-top: 0.25rem;
    }
</style>

<div class="product-form-container">
    <form id="productForm" class="product-form" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
        {% csrf_token %}
        <h2>ADD PRODUCT</h2>
        
        <div class="form-group">
            <input type="text" class="form-control" id="title" name="title" placeholder="Title" required>
            <div id="titleError" class="error-message"></div>
        </div>
        
        <div class="form-group">
            <select class="form-control" id="category" name="category" required>
                <option value="" disabled selected>Select Category</option>
                {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <textarea class="form-control" id="description" name="description" rows="4" placeholder="Description (minimum 100 words)" required></textarea>
            <div id="descriptionError" class="error-message"></div>
        </div>
        
        <div class="form-group">
            <input type="number" class="form-control" id="price" name="price" placeholder="Price" required>
            <div id="priceError" class="error-message"></div>
        </div>
        
        <div class="form-group">
            <select class="form-control" id="brand" name="brand" required>
                <option value="" disabled selected>Select Brand</option>
                {% for choice in brands %}
                <option value="{{ choice.id }}">{{ choice.brand_name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <select class="form-control" id="status" name="status" required>
                <option value="" disabled selected>Select Status</option>
                {% for choice in status_choices %}
                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <input type="number" class="form-control" id="stock_count" name="stock_count" placeholder="Stock Count" required>
            <div id="stockCountError" class="error-message"></div>
        </div>
        
        <div class="form-group">
            <input type="file" class="form-control" id="image" name="image" accept="image/*" required>
            <div id="imageError" class="error-message"></div>
        </div>
        
        <div class="form-group">
            <input type="text" class="form-control" id="sku" name="sku" placeholder="SKU" required>
        </div>
        
        <div class="form-group">
            <input type="number" class="form-control" id="weight" name="weight" step="0.01" placeholder="Weight" required>
        </div>
        
        <div class="form-group">
            <input type="text" class="form-control" id="dimensions" name="size" placeholder="Size" required>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="featured" name="featured">
            <label for="featured">Featured</label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="available" name="available" checked>
            <label for="available">Available</label>
        </div>
        
        <div class="form-group">
            <input type="number" class="form-control" id="offer_price" name="offer_price" placeholder="Offer Price" required>
            <div id="offerPriceError" class="error-message"></div>
        </div>
        
        <div class="form-group">
            <input type="file" class="form-control" id="multipleImages" name="images" accept="image/*" multiple required>
            <small class="form-text text-muted">Max. file size: 10 MB. Allowed images: jpg, gif, png, webp.</small>
            <div id="multipleImagesError" class="error-message"></div>
        </div>
        
        <button type="submit" class="btn-submit">Add Product</button>
    </form>
</div>

<script>
    function validateForm() {
        let isValid = true;

        // Title validation
        const title = document.getElementById('title').value.trim();
        const titleError = document.getElementById('titleError');
        if (title === '' || /[!@#$%^&*(),.?":{}|<>]/.test(title)) {
            titleError.textContent = "Title must not be empty and cannot contain symbols";
            isValid = false;
        } else {
            titleError.textContent = "";
        }

        // Description validation
        const description = document.getElementById('description').value.trim();
        const descriptionError = document.getElementById('descriptionError');
        if (description === '' || description.split(/\s+/).length < 100) {
            descriptionError.textContent = "Description must not be empty and should contain at least 100 words";
            isValid = false;
        } else {
            descriptionError.textContent = "";
        }

        // Price validation
        const price = parseFloat(document.getElementById('price').value);
        const priceError = document.getElementById('priceError');
        if (isNaN(price) || price < 0) {
            priceError.textContent = "Price must be a non-negative number";
            isValid = false;
        } else {
            priceError.textContent = "";
        }

        // Offer price validation
        const offerPrice = parseFloat(document.getElementById('offer_price').value);
        const offerPriceError = document.getElementById('offerPriceError');
        if (isNaN(offerPrice) || offerPrice < 0) {
            offerPriceError.textContent = "Offer price must be a non-negative number";
            isValid = false;
        } else {
            offerPriceError.textContent = "";
        }

        // Stock count validation
        const stockCount = document.getElementById('stock_count').value;
        const stockCountError = document.getElementById('stockCountError');
        if (!/^\d+$/.test(stockCount) || parseInt(stockCount) < 0) {
            stockCountError.textContent = "Stock count must be a non-negative integer";
            isValid = false;
        } else {
            stockCountError.textContent = "";
        }

        // Image validation
        const image = document.getElementById('image');
        const imageError = document.getElementById('imageError');
        if (image.files.length > 0 && !image.files[0].type.startsWith('image/')) {
            imageError.textContent = "Please select a valid image file";
            isValid = false;
        } else {
            imageError.textContent = "";
        }

        // Multiple images validation
        const multipleImages = document.getElementById('multipleImages');
        const multipleImagesError = document.getElementById('multipleImagesError');
        let allFilesAreImages = true;
        for (let i = 0; i < multipleImages.files.length; i++) {
            if (!multipleImages.files[i].type.startsWith('image/')) {
                allFilesAreImages = false;
                break;
            }
        }
        if (!allFilesAreImages) {
            multipleImagesError.textContent = "Please select only image files";
            isValid = false;
        } else {
            multipleImagesError.textContent = "";
        }

        return isValid;
    }

    function removeWhitespace(element) {
        element.value = element.value.trim();
    }

    document.getElementById('description').addEventListener('input', function() {
        removeWhitespace(this);
    });
</script>
{% endblock %}